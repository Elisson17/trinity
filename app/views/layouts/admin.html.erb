<!DOCTYPE html>
<html>
  <head>
    <title>Admin - Trinity</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": Rails.env.production? ? "reload" : "" %>
    <%= javascript_include_tag "application", "data-turbo-track": Rails.env.production? ? "reload" : "", type: "module" %>
  </head>

  <body class="bg-gray-100 min-h-screen" data-admin-layout="true">
    <div id="admin-container" class="flex min-h-screen">
      <%= render "admin/shared/sidebar" %>
      
      <div id="main-content" class="flex-1 transition-all duration-300 ease-in-out ml-[76px]">
        <%= render "admin/shared/header" %>
        
        <main class="p-6">
          <% if notice %>
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
              <%= notice %>
            </div>
          <% end %>
          
          <% if alert %>
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
              <%= alert %>
            </div>
          <% end %>
          
          <%= yield %>
        </main>
      </div>
    </div>

    <script>
      function initializeSidebar() {
        const sidebar = document.getElementById('admin-sidebar');
        const mainContent = document.getElementById('main-content');
        const toggleBtn = document.getElementById('sidebar-toggle');
        
        if (!sidebar || !mainContent || !toggleBtn) return;
        
        let sidebarExpanded = localStorage.getItem('admin-sidebar-expanded') === 'true';
        
        function toggleSidebar() {
          sidebarExpanded = !sidebarExpanded;
          
          if (sidebarExpanded) {
            sidebar.classList.remove('w-[76px]');
            sidebar.classList.add('w-64');
            mainContent.classList.remove('ml-[76px]');
            mainContent.classList.add('ml-64');
            
            document.querySelectorAll('.sidebar-text').forEach(el => {
              el.classList.remove('hidden');
            });
            
            const toggleIcon = document.querySelector('#sidebar-toggle .toggle-icon');
            if (toggleIcon) {
              toggleIcon.innerHTML = '<svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>';
            }
          } else {
            sidebar.classList.remove('w-64');
            sidebar.classList.add('w-[76px]');
            mainContent.classList.remove('ml-64');
            mainContent.classList.add('ml-[76px]');
            
            document.querySelectorAll('.sidebar-text').forEach(el => {
              el.classList.add('hidden');
            });
            
            const toggleIcon = document.querySelector('#sidebar-toggle .toggle-icon');
            if (toggleIcon) {
              toggleIcon.innerHTML = '<svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>';
            }
          }
          
          localStorage.setItem('admin-sidebar-expanded', sidebarExpanded);
        }
        
        const newToggleBtn = toggleBtn.cloneNode(true);
        toggleBtn.parentNode.replaceChild(newToggleBtn, toggleBtn);
        
        newToggleBtn.addEventListener('click', toggleSidebar);
        
        if (sidebarExpanded) {
          sidebar.classList.remove('w-[76px]');
          sidebar.classList.add('w-64');
          mainContent.classList.remove('ml-[76px]');
          mainContent.classList.add('ml-64');
          
          document.querySelectorAll('.sidebar-text').forEach(el => {
            el.classList.remove('hidden');
          });
          
          const toggleIcon = document.querySelector('#sidebar-toggle .toggle-icon');
          if (toggleIcon) {
            toggleIcon.innerHTML = '<svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>';
          }
        }
      }
      
      document.addEventListener('DOMContentLoaded', initializeSidebar);
      
      document.addEventListener('turbo:load', initializeSidebar);
    </script>
  </body>
</html>
